<div class="editor-panel">
	<div class="editor-books-panel">
		<div class="new-notebook">
			<a href="javascript:;" class="create-notebook"> +新建专辑</a> 
			<div class="add-notebook-box">
				<input placeholder="请输入专辑名..." type="text" id="bookName" class="notebook-input"> 
				<a href="javascript:;" class="btn btn-mainGrey w48" id="cancel-create-notebook"> 取消 </a>
				<a href="javascript:;" class="btn btn-mainGreen w48" id="sure－create-notebook"> 确定 </a>
			</div>
		</div>
		<ul class="list-notebook">
			<% bookList.forEach(function(info, index){ %>
			<li class="one-notebook">
				<a href="javascript:;" class="notebook-name">
					<i class="icon-book"></i>
					<span><%- info.name %></span>
				</a>
				<a href="javascript:;" class="notebook-edit" relBID="<%- info._id %>">
					<i class="icon-edit"></i>
				</a> 
				<a href="javascript:;" class="notebook-delete" relBID="<%- info._id %>"> 
					<i class="icon-trash"></i>
				</a> 
			</li>
			<% }); %>
			<li class="one-notebook active">
				<a href="javascript:;" class="notebook-name">
					<i class="icon-book"></i>
					<span>未分类</span>
				</a>
			</li>  
		</ul>
		<div class="commercial">   
			<p>属于作者的专辑, 一个简洁而优雅的环境让你专注于书写。</p>  
		</div>
	</div>
	<div class="editor-articles-panel">
		<div id="new-note">
			<a href="javascript:;" class="new-note-link">
				<i class="icon-pencil"></i>
				<span class="win-text">+新建文章 </span>
			</a> 
		</div>
		<ul class="notes">
			<li class="one-note">
				<i class="icon-file note-icon"></i>
				<p class="abbreviate">x</p>
				<p class="wordage win-text">字数: 1</p>
				<a href="javascript:;" class="note-link-title">无标题文章</a>
			</li>
			<li class="one-note active">
				<i class="icon-file note-icon"></i>
				<p class="abbreviate">x</p>
				<p class="wordage win-text">字数: 1</p>
				<a href="javascript:;" class="note-link-title">无标题文章</a>
			</li>
			
		</ul>
	</div>
</div>
<script type="text/javascript">
$(function(){
	//显示创建专辑面板
	$('.create-notebook').click(function(){
		$('.add-notebook-box').show();
		$('.add-notebook-box').animate({ 
			'height' : '85px'
		}, 500);
	});
	//取消创建专辑面板
	$('#cancel-create-notebook').click(function(){
		$('.add-notebook-box').animate({ 
			'height' : '0px'
		}, 500, function(){
			$('.add-notebook-box').hide();
		});
	});
	//创建专辑
	$('#sure－create-notebook').click(function(){
		var _bookName = $('#bookName').val();
		if(_bookName){
			$.ajax({
                type: 'POST',
                url: '/b/add',
                data: {bookName : _bookName},
                success: function(result){
                    if(0 == result.status){
                        toastr.success('添加专辑成功。');
                        $('#bookName').val('');
                        $('.add-notebook-box').animate({ 
							'height' : '0px'
						}, 500, function(){
							$('.add-notebook-box').hide();
							$('.one-notebook').removeClass('active');
							createBookHtml(result.content);
						});
                    }else{
                        toastr.error(result.content);
                    }
                }
            });
		}else{
			toastr.error('专辑名称不能为空。');
		}
	});
	//选中专辑
	$('.list-notebook').delegate('li', 'click',function(){
		$('.one-notebook').removeClass('active');
		$(this).addClass('active');
	});
	//删除专辑
	$('.list-notebook').delegate('.notebook-delete', 'click',function(){
		var _this = $(this);
		var _bookID = _this.attr('relBID');
		$.ajax({
            type: 'POST',
            url: '/b/del',
            data: {bookID : _bookID},
            success: function(result){
                if(0 == result.status){
                    toastr.success(result.content);
                    _this.parent().animate({ 
						'opacity' : '0'
					}, 500, function(){
						$('.one-notebook').removeClass('active');
						var _ul = _this.parent().parent();
						_this.parent().remove();
						_ul.children('.one-notebook:first').addClass('active');
						
					});
                }else{
                    toastr.error(result.content);
                }
            }
        });
	});

	//修改专辑
	$('.list-notebook').delegate('.notebook-edit', 'click',function(){
		var _this = $(this);
		var _bookID = _this.attr('relBID');
		// $.ajax({
  //           type: 'POST',
  //           url: '/b/update',
  //           data: {bookID : _bookID},
  //           success: function(result){
  //               if(0 == result.status){
  //                   toastr.success(result.content);
                    
  //                   _this.parent().animate({ 
		// 				'opacity' : '0'
		// 			}, 500, function(){
		// 				_this.parent().remove();
		// 			});
  //               }else{
  //                   toastr.error(result.content);
  //               }
  //           }
  //       });
	});


	function createBookHtml(info){
		var html = '<li class="one-notebook active"><a href="javascript:;" class="notebook-name"><i class="icon-notebook"></i><span>' + info.name + '</span></a><a href="javascript:;" class="notebook-edit" relBID="' + info._id + '"><i class="icon-edit"></i></a><a href="javascript:;" class="notebook-delete" relBID="' + info._id + '"><i class="icon-trash"></i></a></li>';
		$('.list-notebook').prepend(html);
	}
});
</script>